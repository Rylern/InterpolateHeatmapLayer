!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.interpolateHeatmapLayer=t():e.interpolateHeatmapLayer=t()}(this,(function(){return(()=>{"use strict";var e={187:e=>{function t(e,t,o){o=o||2;var a,u,f,h,c,m,p,v=t&&t.length,d=v?t[0]*o:e.length,y=r(e,0,d,o,!0),g=[];if(!y||y.next===y.prev)return g;if(v&&(y=function(e,t,n,o){var a,u,f,h=[];for(a=0,u=t.length;a<u;a++)(f=r(e,t[a]*o,a<u-1?t[a+1]*o:e.length,o,!1))===f.next&&(f.steiner=!0),h.push(l(f));for(h.sort(x),a=0;a<h.length;a++)n=i(n=s(h[a],n),n.next);return n}(e,t,y,o)),e.length>80*o){a=f=e[0],u=h=e[1];for(var E=o;E<d;E+=o)(c=e[E])<a&&(a=c),(m=e[E+1])<u&&(u=m),c>f&&(f=c),m>h&&(h=m);p=0!==(p=Math.max(f-a,h-u))?1/p:0}return n(y,g,o,a,u,p),g}function r(e,t,r,i,n){var o,a;if(n===A(e,t,r,i)>0)for(o=t;o<r;o+=i)a=T(o,e[o],e[o+1],a);else for(o=r-i;o>=t;o-=i)a=T(o,e[o],e[o+1],a);return a&&d(a,a.next)&&(F(a),a=a.next),a}function i(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!d(i,i.next)&&0!==v(i.prev,i,i.next))i=i.next;else{if(F(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function n(e,t,r,x,s,h,l){if(e){!l&&h&&function(e,t,r,i){var n=e;do{null===n.z&&(n.z=c(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,o,a,u,f,x=1;do{for(r=e,e=null,o=null,a=0;r;){for(a++,i=r,u=0,t=0;t<x&&(u++,i=i.nextZ);t++);for(f=x;u>0||f>0&&i;)0!==u&&(0===f||!i||r.z<=i.z)?(n=r,r=r.nextZ,u--):(n=i,i=i.nextZ,f--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;r=i}o.nextZ=null,x*=2}while(a>1)}(n)}(e,x,s,h);for(var m,p,v=e;e.prev!==e.next;)if(m=e.prev,p=e.next,h?a(e,x,s,h):o(e))t.push(m.i/r),t.push(e.i/r),t.push(p.i/r),F(e),e=p.next,v=p.next;else if((e=p)===v){l?1===l?n(e=u(i(e),t,r),t,r,x,s,h,2):2===l&&f(e,t,r,x,s,h):n(i(e),t,r,x,s,h,1);break}}}function o(e){var t=e.prev,r=e,i=e.next;if(v(t,r,i)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(m(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&v(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function a(e,t,r,i){var n=e.prev,o=e,a=e.next;if(v(n,o,a)>=0)return!1;for(var u=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,f=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,x=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,s=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,h=c(u,f,t,r,i),l=c(x,s,t,r,i),p=e.prevZ,d=e.nextZ;p&&p.z>=h&&d&&d.z<=l;){if(p!==e.prev&&p!==e.next&&m(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,d!==e.prev&&d!==e.next&&m(n.x,n.y,o.x,o.y,a.x,a.y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&m(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;d&&d.z<=l;){if(d!==e.prev&&d!==e.next&&m(n.x,n.y,o.x,o.y,a.x,a.y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function u(e,t,r){var n=e;do{var o=n.prev,a=n.next.next;!d(o,a)&&y(o,n,n.next,a)&&_(o,a)&&_(a,o)&&(t.push(o.i/r),t.push(n.i/r),t.push(a.i/r),F(n),F(n.next),n=e=a),n=n.next}while(n!==e);return i(n)}function f(e,t,r,o,a,u){var f=e;do{for(var x=f.next.next;x!==f.prev;){if(f.i!==x.i&&p(f,x)){var s=b(f,x);return f=i(f,f.next),s=i(s,s.next),n(f,t,r,o,a,u),void n(s,t,r,o,a,u)}x=x.next}f=f.next}while(f!==e)}function x(e,t){return e.x-t.x}function s(e,t){var r=function(e,t){var r,i=t,n=e.x,o=e.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var u=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(u<=n&&u>a){if(a=u,u===n){if(o===i.y)return i;if(o===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===a)return r;var f,x=r,s=r.x,c=r.y,l=1/0;i=r;do{n>=i.x&&i.x>=s&&n!==i.x&&m(o<c?n:a,o,s,c,o<c?a:n,o,i.x,i.y)&&(f=Math.abs(o-i.y)/(n-i.x),_(i,e)&&(f<l||f===l&&(i.x>r.x||i.x===r.x&&h(r,i)))&&(r=i,l=f)),i=i.next}while(i!==x);return r}(e,t);if(!r)return t;var n=b(r,e),o=i(r,r.next);return i(n,n.next),t===r?o:t}function h(e,t){return v(e.prev,e,t.prev)<0&&v(t.next,e,e.next)<0}function c(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function l(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function m(e,t,r,i,n,o,a,u){return(n-a)*(t-u)-(e-a)*(o-u)>=0&&(e-a)*(i-u)-(r-a)*(t-u)>=0&&(r-a)*(o-u)-(n-a)*(i-u)>=0}function p(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&y(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(_(e,t)&&_(t,e)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)&&(v(e.prev,e,t.prev)||v(e,t.prev,t))||d(e,t)&&v(e.prev,e,e.next)>0&&v(t.prev,t,t.next)>0)}function v(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function d(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,r,i){var n=E(v(e,t,r)),o=E(v(e,t,i)),a=E(v(r,i,e)),u=E(v(r,i,t));return n!==o&&a!==u||!(0!==n||!g(e,r,t))||!(0!==o||!g(e,i,t))||!(0!==a||!g(r,e,i))||!(0!==u||!g(r,t,i))}function g(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function E(e){return e>0?1:e<0?-1:0}function _(e,t){return v(e.prev,e,e.next)<0?v(e,t,e.next)>=0&&v(e,e.prev,t)>=0:v(e,t,e.prev)<0||v(e,e.next,t)<0}function b(e,t){var r=new R(e.i,e.x,e.y),i=new R(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function T(e,t,r,i){var n=new R(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function F(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function R(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(e,t,r,i){for(var n=0,o=t,a=r-i;o<r;o+=i)n+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return n}e.exports=t,e.exports.default=t,t.deviation=function(e,t,r,i){var n=t&&t.length,o=n?t[0]*r:e.length,a=Math.abs(A(e,0,o,r));if(n)for(var u=0,f=t.length;u<f;u++){var x=t[u]*r,s=u<f-1?t[u+1]*r:e.length;a-=Math.abs(A(e,x,s,r))}var h=0;for(u=0;u<i.length;u+=3){var c=i[u]*r,l=i[u+1]*r,m=i[u+2]*r;h+=Math.abs((e[c]-e[m])*(e[l+1]-e[c+1])-(e[c]-e[l])*(e[m+1]-e[c+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},t.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var a=0;a<t;a++)r.vertices.push(e[n][o][a]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r}}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{r.r(i),r.d(i,{create:()=>n});var e=r(187),t=r.n(e);function n(e){const r={layerId:"",opacity:.5,minValue:1/0,maxValue:-1/0,p:3,framebufferFactor:.3,points:[],roi:[],valueToColor:"\n            vec3 valueToColor(float value) {\n                return vec3(max((value-0.5)*2.0, 0.0), 1.0 - 2.0*abs(value - 0.5), max((0.5-value)*2.0, 0.0));\n            }\n        "};if("object"==typeof e)for(let t in e)r[t]=e[t];const i=1==r.framebufferFactor;return{id:r.layerId,type:"custom",onAdd:function(e,a){if(!a.getExtension("OES_texture_float")||!a.getExtension("WEBGL_color_buffer_float")||!a.getExtension("EXT_float_blend"))throw"WebGL extension not supported";this.canvas=e._canvas;const f=`\n                precision highp float;\n\n                ${r.valueToColor}\n\n                uniform sampler2D u_ComputationTexture;\n                uniform vec2 u_ScreenSize;\n                uniform float u_Opacity;\n\n                void main(void) {\n                    vec4 data = texture2D(u_ComputationTexture, vec2(gl_FragCoord.x/u_ScreenSize.x, gl_FragCoord.y/u_ScreenSize.y));\n                    float u = data.x/data.y;\n                    gl_FragColor.rgb = valueToColor(u);\n                    gl_FragColor.a = u_Opacity;\n                }\n            `,x=n(a,"\n                precision highp float;\n                uniform mat4 u_Matrix;\n                uniform vec2 xi;\n                varying vec2 xiNormalized;\n                attribute vec2 a_Position;\n                void main() {\n                    vec4 xiProjected = u_Matrix * vec4(xi, 0.0, 1.0);\n                    xiNormalized = vec2(xiProjected.x / xiProjected.w, xiProjected.y / xiProjected.w);\n                    gl_Position = u_Matrix * vec4(a_Position, 0.0, 1.0);\n                }\n            "),s=o(a,"\n                precision highp float;\n                uniform float ui;\n                varying vec2 xiNormalized;\n                uniform float p;\n                uniform vec2 u_FramebufferSize;\n                void main() {\n                    vec2 x = vec2(gl_FragCoord.x/u_FramebufferSize.x, gl_FragCoord.y/u_FramebufferSize.y);\n                    vec2 xi = vec2((xiNormalized.x + 1.)/2., (xiNormalized.y + 1.)/2.);\n                    float dist = distance(x, xi);\n                    float wi = 1.0/pow(dist, p);\n                    gl_FragColor = vec4(ui*wi, wi, 0.0, 1.0);\n                }\n            ");if(this.computationProgram=u(a,x,s),this.aPositionComputation=a.getAttribLocation(this.computationProgram,"a_Position"),this.uMatrixComputation=a.getUniformLocation(this.computationProgram,"u_Matrix"),this.uUi=a.getUniformLocation(this.computationProgram,"ui"),this.uXi=a.getUniformLocation(this.computationProgram,"xi"),this.uP=a.getUniformLocation(this.computationProgram,"p"),this.uFramebufferSize=a.getUniformLocation(this.computationProgram,"u_FramebufferSize"),this.aPositionComputation<0||!this.uMatrixComputation||!this.uUi||!this.uXi||!this.uP||!this.uFramebufferSize)throw"WebGL error: Failed to get the storage location of computation variable";const h=n(a,"\n                precision highp float;\n                attribute vec2 a_Position;\n                uniform mat4 u_Matrix;\n                void main() {\n                    gl_Position = u_Matrix * vec4(a_Position, 0.0, 1.0);\n                }\n            "),c=o(a,f);if(this.drawProgram=u(a,h,c),this.aPositionDraw=a.getAttribLocation(this.drawProgram,"a_Position"),this.uMatrixDraw=a.getUniformLocation(this.drawProgram,"u_Matrix"),this.uComputationTexture=a.getUniformLocation(this.drawProgram,"u_ComputationTexture"),this.uScreenSizeDraw=a.getUniformLocation(this.drawProgram,"u_ScreenSize"),this.uOpacity=a.getUniformLocation(this.drawProgram,"u_Opacity"),this.aPositionDraw<0||!this.uMatrixDraw||!this.uComputationTexture||!this.uScreenSizeDraw||!this.uOpacity)throw"WebGL error: Failed to get the storage location of drawing variable";const l=[];0==r.roi.length?l.push(-1,-1,-1,1,1,1,1,-1):r.roi.forEach((e=>{const t=mapboxgl.MercatorCoordinate.fromLngLat(e);l.push(t.x,t.y)})),this.drawingVerticesBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.drawingVerticesBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(l),a.STATIC_DRAW);const m=i?l:[1,1,-1,1,1,-1,-1,-1];this.computationVerticesBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.computationVerticesBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(m),a.STATIC_DRAW);const p=t()(l);this.indicesBuffer=a.createBuffer(),this.indicesBuffer.indicesNumber=p.length,a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indicesBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint8Array(p),a.STATIC_DRAW),this.framebufferWidth=Math.ceil(this.canvas.width*r.framebufferFactor),this.framebufferHeight=Math.ceil(this.canvas.height*r.framebufferFactor),this.computationTexture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.computationTexture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.framebufferWidth,this.framebufferHeight,0,a.RGBA,a.FLOAT,null),this.computationFramebuffer=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,this.computationFramebuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.computationTexture,0),a.bindTexture(a.TEXTURE_2D,null),a.bindFramebuffer(a.FRAMEBUFFER,null),this.points=[];let v=1/0,d=-1/0;r.points.forEach((e=>{const t=mapboxgl.MercatorCoordinate.fromLngLat(e);this.points.push([t.x,t.y,e.val]),e.val<v&&(v=e.val),e.val>d&&(d=e.val)})),v=v<r.minValue?v:r.minValue,d=d>r.maxValue?d:r.maxValue,this.points.forEach((e=>{e[2]=(e[2]-v)/(d-v)})),this.resizeFramebuffer=()=>{this.framebufferWidth=Math.ceil(this.canvas.width*r.framebufferFactor),this.framebufferHeight=Math.ceil(this.canvas.height*r.framebufferFactor),a.bindTexture(a.TEXTURE_2D,this.computationTexture),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.framebufferWidth,this.framebufferHeight,0,a.RGBA,a.FLOAT,null)},e.on("resize",this.resizeFramebuffer)},onRemove:function(e,t){e.off("resize",this.resizeFramebuffer),t.deleteTexture(this.computationTexture),t.deleteBuffer(this.drawingVerticesBuffer),t.deleteBuffer(this.computationVerticesBuffer),t.deleteBuffer(this.indicesBuffer),t.deleteFramebuffer(this.computationFramebuffer)},prerender:function(e,t){e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ONE),e.clearColor(0,0,0,1),e.useProgram(this.computationProgram),e.uniformMatrix4fv(this.uMatrixComputation,!1,t),e.uniform1f(this.uP,r.p),e.uniform2f(this.uFramebufferSize,this.framebufferWidth,this.framebufferHeight),e.bindFramebuffer(e.FRAMEBUFFER,this.computationFramebuffer),e.viewport(0,0,this.framebufferWidth,this.framebufferHeight),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indicesBuffer);for(let t=0;t<this.points.length;t++){const r=this.points[t];e.uniform1f(this.uUi,r[2]),e.uniform2f(this.uXi,r[0],r[1]),e.bindBuffer(e.ARRAY_BUFFER,this.computationVerticesBuffer),e.enableVertexAttribArray(this.aPositionComputation),e.vertexAttribPointer(this.aPositionComputation,2,e.FLOAT,!1,0,0),i?e.drawElements(e.TRIANGLES,this.indicesBuffer.indicesNumber,e.UNSIGNED_BYTE,0):e.drawArrays(e.TRIANGLE_STRIP,0,4)}e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.canvas.width,this.canvas.height)},render:function(e,t){e.useProgram(this.drawProgram),e.bindBuffer(e.ARRAY_BUFFER,this.drawingVerticesBuffer),e.enableVertexAttribArray(this.aPositionDraw),e.vertexAttribPointer(this.aPositionDraw,2,e.FLOAT,!1,0,0),e.uniformMatrix4fv(this.uMatrixDraw,!1,t),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.computationTexture),e.uniform1i(this.uComputationTexture,0),e.uniform2f(this.uScreenSizeDraw,this.canvas.width,this.canvas.height),e.uniform1f(this.uOpacity,r.opacity),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indicesBuffer),e.drawElements(e.TRIANGLES,this.indicesBuffer.indicesNumber,e.UNSIGNED_BYTE,0)}};function n(e,t){const r=e.createShader(e.VERTEX_SHADER);return a(e,r,t)}function o(e,t){const r=e.createShader(e.FRAGMENT_SHADER);return a(e,r,t)}function a(e,t,r){if(e.shaderSource(t,r),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))throw e.getShaderInfoLog(t);return t}function u(e,t,r){const i=e.createProgram();if(e.attachShader(i,t),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS))throw e.getProgramInfoLog(i);return i}}})(),i})()}));